{% extends 'base2.html' %}
{% load static %}

{% block content %}
<!--Page header-->
<div class="page-header">
    <div class="page-leftheader">
        <h4 class="page-title">Dashboard</h4>
    </div>
    <div class="page-rightheader ml-auto d-lg-flex d-none">
        <div class="ml-5 mb-0">
            <a class="btn btn-white date-range-btn" href="#" id="daterange-btn">
                <svg class="header-icon2 mr-3" x="1008" y="1248" viewBox="0 0 24 24"  height="100%" width="100%" preserveAspectRatio="xMidYMid meet" focusable="false">
                    <path d="M5 8h14V6H5z" opacity=".3"/><path d="M7 11h2v2H7zm12-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10zm0-12H5V6h14v2zm-4 3h2v2h-2zm-4 0h2v2h-2z"/>
                </svg> <span>Select Date
                <i class="fa fa-caret-down"></i></span>
            </a>
        </div>
    </div>
</div>
<!--End Page header-->
<!-- <a href="{% url 'login' %}">Login</a> -->
<form method="post">
    {% csrf_token %}
    {% if messages %}
    <div class="alert alert-danger">
        <ul>
            {% for message in messages %}
                <li>{{ message }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    <div class="row">
        <div class="col-md-6">
            <div class="form-group">
                <label for="{{ form.owner.id_for_label }}">Owner Name</label>
                {{ form.owner }}
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label class="form-label">Mobile Number</label>
                <input type="text" class="form-control" placeholder="Mobile Number" name="mobile">
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="id_floor">Floor:<span class="text-red">*</span></label>
                <select name="floor" id="id_floor" class="form-control custom-select select2">
                    <option value="">--Select--</option>
                    {% for choice in form.floor.field.choices %}
                        <option value="{{ choice.0 }}">{{ choice.1 }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group">
                <label for="id_room">Room Number:<span class="text-red">*</span></label>
                <select name="room" id="id_room" class="form-control">
                    <option value="">--Select--</option>
                </select>
            </div>
        </div>
        
        <div class="col-md-12">
            <button type="submit" value="Submit" class="btn btn-primary mt-4 mb-0">Submit</button>
        </div>
    </div>
    {% if form.room.errors %}
    <div class="alert alert-danger mt-3">
        <ul>
            {% for error in form.room.errors %}
                <li>{{ error }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function () {
        $('#id_floor').change(function () {
            var selectedFloor = $(this).val();
            $.ajax({
                url: "{% url 'get_rooms_by_floor' %}",
                data: { 'floor': selectedFloor },
                dataType: 'json',
                success: function (data) {
                    var roomDropdown = $('#id_room');
                    roomDropdown.empty();
                    roomDropdown.append($('<option>', {
                        value: '',
                        text: '--Select--'
                    }));
                    $.each(data.rooms, function (index, room) {
                        roomDropdown.append($('<option>', {
                            value: room.id,
                            text: room.room_number
                        }));
                    });
                }
            });
        });
    });
</script>
{% endblock %}
